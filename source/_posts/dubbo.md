---
title: Dubbo
date: 2019-10-04 08:42:34
update: 2019-10-04 08:42:34
categories: DUBBO
tags: [dubbo]
---

<img src="https://dubbo.apache.org/img/dubbo_gray.png"/>

![dubbo-e](https://volc1612.gitee.io/blog/images/dubbo/dubbo-e.png)

### 什么是Dubbo

Dubbo是由阿里开源，后来加入了 Apache 。正式由于 Dubbo 的出现，才使得越来越多的公司开始使用以及接受分布式架构。是⼀个⾼性能，轻量级，基于Java的RPC框架。Dubbo提供三个关键功能，包括基
于接⼝的远程调⽤，容错和负载平衡以及⾃动服务注册和发现。

<!-- more -->

#### 什么是RPC

RPC（Remote Procedure Call）—远程过程调用，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。比如两个不同的服务A,B部署在两台不同的机器上，那么服务 A 如果想要调用服务 B 中的某个方法该怎么办呢？使用 HTTP请求 当然可以，但是可能会比较慢而且一些优化做的并不好。 RPC 的出现就是为了解决这个问题。

#### RPC原理是什么

  * 连接：通过在客户端和服务器之间建立TCP连接，远程过程调用的所有交换的数据都在这个连接里传输
  * 寻址：A服务器上的应用怎么告诉底层的RPC框架，如何连接到B服务器（如主机或IP地址）以及特定的端口
  * 编码：网络协议是基于二进制的，内存中的参数的值要序列化成二进制的形式，也就是序列化（Serialize）或编组（marshal），通过寻址和传输将序列化的二进制发送给B服务器
  * 解码：B服务器收到请求后，需要对参数进行反序列化（序列化的逆操作），恢复为内存中的表达方式，然后找到对应的方法（寻址的一部分）进行本地调用，然后得到返回值
  * 处理返回值：返回值还要发送回服务器A上的应用，也要经过序列化的方式发送，服务器A接到后，再反序列化，恢复为内存中的表达方式，交给A服务器上的应用

![dubbo](https://volc1612.gitee.io/blog/images/dubbo/dubbo-a.jpg)

下面再贴一个网上的时序图：

![dubbo](https://volc1612.gitee.io/blog/images/dubbo/dubbo-b.jpg)

参开文章：https://caojiele.com/2019/03/30/dubbo/

#### Dubbo功能解析

![dubbo](https://volc1612.gitee.io/blog/images/dubbo/dubbo-c.jpg)

* 调用功能指责
  * 服务容器负责启动，加载，运行服务提供者
  * 服务提供者在启动时，向注册中心注册自己提供的服务。
  * 服务消费者在启动时，向注册中心订阅自己所需的服务。
  * 注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。
  * 服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。
    * 软负载均衡区分于硬负载均衡（例如F5硬负均衡器），是一种基于软件实现的负载均衡(例如:nginx负载均衡)
  * 服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心
    * map(调用id，times)  map(调用id,int)，防止于集装箱进行汇总再上报到注册中心

#### 为什么要用Dubbo

* 负载均衡——同一个服务部署在不同的机器时该调用那一台机器上的服务
* 服务调用链路生成——随着系统的发展，服务越来越多，服务间依赖关系变得错踪复杂，甚至分不清哪个应用要在哪个应用之前启动，架构师都不能完整的描述应用的架构关系。Dubbo 可以为我们解决服务之间互相是如何调用的。
* 服务访问压力以及时长统计、资源调度和治理——基于访问压力实时管理集群容量，提高集群利用率。
* 服务降级——某个服务挂掉之后调用备用服务

### 互联网经典面试题分析之为什么有了Http还要用dubbo

**简介：还原蚂蚁金服Dubbo相关面试题**

* 问题分析流程，面试官所问的这个问题包含的哪些知识点？
  * dubbo的定义(定位)
  * rpc相对于http的优势

  ![dubbo-f](https://volc1612.gitee.io/blog/images/dubbo/dubbo-f.jpg)

* 这个问题应该从哪些方面着手去回答

  * 通用定义的http1.1协议的tcp报文包含无用信息，一个POST协议的格式大致如下(数据大小)，而RPC框架在内部调用没有很严格消息体，轻量级的请求格式
    ```shell
    HTTP/1.0 200 OK 
    Content-Type: text/plain
    Content-Length: 137521
    Expires: Thu, 05 Dec 2019 16:00:00 GMT
    Last-Modified: Wed, 5 August 2019 15:55:28 GMT
    Server: Apache 0.84

    <html>
      <body>Hello xdclass</body>
    </html>
    ```

  * RPC封装了“服务发现”，"负载均衡"，“熔断降级”一类面向服务的高级特性，这些是http做不到的(RPC特色)

  * 从个人使用经验来讲RPC调用还拥有传输安全的优势，防止了Http调用的数据包篡改和流量劫持(个人经验)

* 技巧总结==》不经意之间测漏自己是有相关技术实战经验的开发人员